<mxfile host="app.diagrams.net" modified="2025-01-01T19:30:00.000Z" agent="FlexPay-v2" version="24.7.17" etag="flow-v2-fixed" type="device">
  <diagram name="Transaction-Flow-v2" id="transaction_flow_v2_fixed">
    <mxGraphModel dx="1800" dy="1200" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1800" pageHeight="1400" background="light-dark(#222326, #121212)" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="FlexPay v2.0 - SAGA Transaction Flow (End-to-End)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="800" height="40" as="geometry" />
        </mxCell>

        <mxCell id="subtitle" value="Production-Ready Payment Processing with Enterprise Patterns" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="500" y="60" width="800" height="20" as="geometry" />
        </mxCell>

        <!-- Swimlanes -->
        <mxCell id="customer_lane" value="Customer Experience" style="swimlane;fillColor=none;strokeColor=#2196f3;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="100" width="1600" height="150" as="geometry" />
        </mxCell>

        <mxCell id="frontend_lane" value="Frontend Layer (Multi-Channel BFF)" style="swimlane;fillColor=none;strokeColor=#ff9800;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="250" width="1600" height="150" as="geometry" />
        </mxCell>

        <mxCell id="zerotrust_lane" value="Zero Trust Gateway + Security" style="swimlane;fillColor=none;strokeColor=#7b1fa2;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="400" width="1600" height="150" as="geometry" />
        </mxCell>

        <mxCell id="services_lane" value="Core Services (SAGA Orchestration)" style="swimlane;fillColor=none;strokeColor=#4caf50;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="550" width="1600" height="200" as="geometry" />
        </mxCell>

        <mxCell id="events_lane" value="Event Streaming and Async Processing" style="swimlane;fillColor=none;strokeColor=#c2185b;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="750" width="1600" height="150" as="geometry" />
        </mxCell>

        <mxCell id="external_lane" value="External Systems and Networks" style="swimlane;fillColor=none;strokeColor=#ff5722;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="900" width="1600" height="200" as="geometry" />
        </mxCell>

        <mxCell id="observability_lane" value="Observability and Incident Response" style="swimlane;fillColor=none;strokeColor=#795548;strokeWidth=2;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="1100" width="1600" height="120" as="geometry" />
        </mxCell>

        <!-- Customer Experience Layer -->
        <mxCell id="customer_action" value="1. Customer Initiates Payment Card/PIX/Boleto" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="140" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="payment_confirmation" value="12. Payment Confirmation Real-time status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="1520" y="140" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Frontend Layer -->
        <mxCell id="checkout_widget" value="2. Checkout Widget/SDK PCI-compliant" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="290" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="checkout_bff" value="3. Checkout BFF TypeScript Optimized API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="320" y="290" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Zero Trust Gateway -->
        <mxCell id="kong_gateway" value="4. Kong Gateway Rate limiting Circuit breakers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7b1fa2;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="440" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auth0_sso" value="Auth0 + JWT Validation Enterprise SSO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7b1fa2;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="320" y="440" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="pci_vault" value="PCI Vault Tokenization Secure isolation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d32f2f;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="490" y="440" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Core Services (SAGA) -->
        <mxCell id="saga_orchestrator" value="5. SAGA Engine Transaction coordinator State machine" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="590" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="payment_service" value="6. Payment Service Java Spring Boot Multi-rail routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="320" y="590" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="fraud_ml" value="7. Fraud ML Python FastAPI Real-time scoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="490" y="590" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="network_adapters" value="Network Adapters Java jPOS ISO8583 dynamic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="660" y="590" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Event Streaming -->
        <mxCell id="kafka_events" value="8. Kafka MSK Event streaming Audit trail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c2185b;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="790" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="sns_sqs" value="SNS/SQS Fan-out pattern Async processing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c2185b;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="320" y="790" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="webhook_svix" value="9. Svix Webhooks Reliable delivery Retry automation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c2185b;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="490" y="790" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- External Systems -->
        <mxCell id="mastercard" value="Mastercard Network processing MDES tokens" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff5722;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="950" width="130" height="80" as="geometry" />
        </mxCell>

        <mxCell id="visa" value="Visa VIP support BASE24 clearing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff5722;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="320" y="950" width="130" height="80" as="geometry" />
        </mxCell>

        <mxCell id="banks_pix" value="Banking APIs PIX integration Open Banking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff5722;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="490" y="950" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Observability -->
        <mxCell id="newrelic_apm" value="New Relic APM Performance monitoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#795548;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="150" y="1140" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="incident_io" value="Incident.io Response automation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#795548;fontColor=#FFD966;align=center;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="320" y="1140" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- SAGA Flow States -->
        <mxCell id="saga_states" value="SAGA States: START → RESERVE → VERIFY → PROCESS → UPDATE → SETTLE → NOTIFY → COMPLETE" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#FFD966;sketch=1;curveFitting=1;jiggle=2;" vertex="1" parent="1">
          <mxGeometry x="100" y="1250" width="1600" height="30" as="geometry" />
        </mxCell>

        <!-- Flow Arrows -->
        <mxCell id="arrow1" value="" style="endArrow=classic;html=1;strokeColor=#FFD966;strokeWidth=2;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="customer_action" target="checkout_widget">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="300" as="sourcePoint" />
            <mxPoint x="450" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow2" value="" style="endArrow=classic;html=1;strokeColor=#FFD966;strokeWidth=2;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="checkout_widget" target="checkout_bff">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="300" as="sourcePoint" />
            <mxPoint x="450" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow3" value="" style="endArrow=classic;html=1;strokeColor=#FFD966;strokeWidth=2;sketch=1;curveFitting=1;jiggle=2;" edge="1" parent="1" source="checkout_bff" target="kong_gateway">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="400" as="sourcePoint" />
            <mxPoint x="450" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>