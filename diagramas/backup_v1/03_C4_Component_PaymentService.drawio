<mxfile host="Electron" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/27.0.9 Chrome/134.0.6998.205 Electron/35.4.0 Safari/537.36" version="27.0.9">
  <diagram name="C4-Component-PaymentService" id="c4-component-payment">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Título -->
        <mxCell id="title" value="C4 Model - Nível 3: Componentes - Payment Service" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="469" height="30" as="geometry"/>
        </mxCell>

        <!-- Subtítulo -->
        <mxCell id="subtitle" value="FlexPay Commerce - Componentes internos do Payment Service Container" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=0;fontColor=#666666" vertex="1" parent="1">
          <mxGeometry x="300" y="50" width="569" height="20" as="geometry"/>
        </mxCell>

        <!-- Payment Controller -->
        <mxCell id="payment-controller" value="Payment Controller&#xa;[Component: Node.js/Express]&#xa;&#xa;Recebe requisições de pagamento,&#xa;valida entrada, orquestra fluxo&#xa;e retorna resposta padronizada" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="150" y="120" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Payment Manager -->
        <mxCell id="payment-manager" value="Payment Manager&#xa;[Component: Node.js]&#xa;&#xa;Orquestra processamento,&#xa;coordena validações, executa&#xa;business rules e gerencia estado" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="120" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Tokenization Engine -->
        <mxCell id="tokenization-engine" value="Tokenization Engine&#xa;[Component: Node.js/AES-256]&#xa;&#xa;Gera tokens seguros para cartões,&#xa;criptografia reversível, compliance&#xa;PCI-DSS Level 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="150" y="280" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Risk Checker -->
        <mxCell id="risk-checker" value="Risk Checker&#xa;[Component: Python/ML]&#xa;&#xa;Análise de risco em tempo real,&#xa;machine learning para fraudes,&#xa;scoring baseado em 50+ regras" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="280" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Gateway Adapter -->
        <mxCell id="gateway-adapter" value="Gateway Adapter&#xa;[Component: Node.js]&#xa;&#xa;Abstração para múltiplos gateways,&#xa;fallback automático, normalização&#xa;de respostas e retry logic" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="810" y="120" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Validation Rules -->
        <mxCell id="validation-rules" value="Validation Rules&#xa;[Component: Node.js/JSON]&#xa;&#xa;Regras de validação configuráveis,&#xa;BIN ranges, limites por merchant,&#xa;validação Luhn e CVV" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="810" y="280" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Payment Repository -->
        <mxCell id="payment-repository" value="Payment Repository&#xa;[Component: Node.js/Prisma]&#xa;&#xa;Camada de acesso a dados,&#xa;transações ACID, auditoria&#xa;completa e data retention" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="440" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Event Publisher -->
        <mxCell id="event-publisher" value="Event Publisher&#xa;[Component: Node.js/Kafka]&#xa;&#xa;Publica eventos de pagamento,&#xa;garantia de entrega, schema&#xa;registry e dead letter queue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="150" y="440" width="200" height="100" as="geometry"/>
        </mxCell>

        <!-- Fluxos de dados principais -->
        <!-- Controller -> Manager -->
        <mxCell id="controller-manager" value="Processa Pagamento&#xa;[HTTPS/JSON]" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-controller" target="payment-manager">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="370" y="170" as="sourcePoint"/>
            <mxPoint x="420" y="120" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Manager -> Risk Checker -->
        <mxCell id="manager-risk" value="Verifica Risco&#xa;[HTTP/JSON]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-manager" target="risk-checker">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="230" as="sourcePoint"/>
            <mxPoint x="580" y="270" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Manager -> Gateway Adapter -->
        <mxCell id="manager-gateway" value="Executa Cobrança&#xa;[HTTPS/JSON]" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-manager" target="gateway-adapter">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="700" y="170" as="sourcePoint"/>
            <mxPoint x="800" y="170" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Manager -> Repository -->
        <mxCell id="manager-repository" value="Persiste Dados&#xa;[SQL/Prisma]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-manager" target="payment-repository">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="230" as="sourcePoint"/>
            <mxPoint x="580" y="430" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Controller -> Tokenization -->
        <mxCell id="controller-tokenization" value="Tokeniza Cartão&#xa;[Internal/AES]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-controller" target="tokenization-engine">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="230" as="sourcePoint"/>
            <mxPoint x="250" y="270" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Gateway -> Validation -->
        <mxCell id="gateway-validation" value="Valida Regras&#xa;[Internal/JSON]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="gateway-adapter" target="validation-rules">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="910" y="230" as="sourcePoint"/>
            <mxPoint x="910" y="270" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Manager -> Event Publisher -->
        <mxCell id="manager-events" value="Publica Eventos&#xa;[Kafka/Avro]" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-manager" target="event-publisher">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="480" y="220" as="sourcePoint"/>
            <mxPoint x="350" y="440" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Sistemas Externos -->
        <!-- API Gateway (entrada) -->
        <mxCell id="api-gateway-external" value="API Gateway&#xa;[Sistema Externo: Kong]&#xa;&#xa;Rate limiting, autenticação,&#xa;load balancing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#999999;fontColor=#ffffff;strokeColor=#666666;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="150" y="20" width="200" height="70" as="geometry"/>
        </mxCell>

        <!-- Akua.la Gateway -->
        <mxCell id="akua-gateway-external" value="Akua.la Gateway&#xa;[Sistema Externo]&#xa;&#xa;Processamento de cartões" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#999999;fontColor=#ffffff;strokeColor=#666666;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="810" y="20" width="200" height="70" as="geometry"/>
        </mxCell>

        <!-- PostgreSQL -->
        <mxCell id="postgresql-external" value="PostgreSQL&#xa;[Database]&#xa;&#xa;Transações, merchants, logs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#999999;fontColor=#ffffff;strokeColor=#666666;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="480" y="580" width="200" height="70" as="geometry"/>
        </mxCell>

        <!-- Kafka -->
        <mxCell id="kafka-external" value="Apache Kafka&#xa;[Message Broker]&#xa;&#xa;Event streaming" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#999999;fontColor=#ffffff;strokeColor=#666666;align=center;verticalAlign=middle;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="150" y="580" width="200" height="70" as="geometry"/>
        </mxCell>

        <!-- Conexões externas -->
        <!-- API Gateway -> Controller -->
        <mxCell id="apigateway-controller" value="Requisição HTTP&#xa;[HTTPS/JSON]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="api-gateway-external" target="payment-controller">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="100" as="sourcePoint"/>
            <mxPoint x="250" y="110" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Gateway Adapter -> Akua.la -->
        <mxCell id="adapter-akua" value="Processa Cartão&#xa;[HTTPS/JSON]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="gateway-adapter" target="akua-gateway-external">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="910" y="110" as="sourcePoint"/>
            <mxPoint x="910" y="100" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Repository -> PostgreSQL -->
        <mxCell id="repository-postgres" value="SQL Queries&#xa;[TCP/SQL]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="payment-repository" target="postgresql-external">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="580" y="550" as="sourcePoint"/>
            <mxPoint x="580" y="570" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Event Publisher -> Kafka -->
        <mxCell id="publisher-kafka" value="Publica Mensagens&#xa;[TCP/Avro]" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=10;fontColor=#333333" edge="1" parent="1" source="event-publisher" target="kafka-external">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="250" y="550" as="sourcePoint"/>
            <mxPoint x="250" y="570" as="targetPoint"/>
          </mxGeometry>
        </mxCell>

        <!-- Legenda -->
        <mxCell id="legend-title" value="LEGENDA" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="50" y="680" width="100" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="legend-component" value="Componente do Payment Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1ba1e2;fontColor=#ffffff;strokeColor=#006EAF;align=center;verticalAlign=middle;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="50" y="710" width="150" height="30" as="geometry"/>
        </mxCell>

        <mxCell id="legend-external" value="Sistema/Database Externo" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#999999;fontColor=#ffffff;strokeColor=#666666;align=center;verticalAlign=middle;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="220" y="710" width="150" height="30" as="geometry"/>
        </mxCell>

        <!-- Nota sobre escopo -->
        <mxCell id="scope-note" value="Escopo: Este diagrama mostra os componentes internos do Payment Service Container&#xa;definido no diagrama C4 Level 2. Cada componente tem uma responsabilidade específica&#xa;e bem definida, seguindo princípios de Single Responsibility e Clean Architecture." style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=11;fontStyle=0" vertex="1" parent="1">
          <mxGeometry x="400" y="680" width="500" height="60" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>