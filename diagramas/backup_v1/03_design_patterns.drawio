<mxfile host="app.diagrams.net" modified="2025-01-01T12:00:00.000Z" agent="FlexPay" version="24.7.17" etag="patterns" type="device">
  <diagram name="Design-Patterns" id="design_patterns">
    <mxGraphModel dx="1600" dy="900" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" background="light-dark(#222326, #121212)" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="FlexPay - Design Patterns Implementation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- CQRS Pattern -->
        <mxCell id="cqrs_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#5e35b1;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="680" height="250" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_label" value="&lt;b&gt;CQRS Pattern - Payment Service&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#4527a0;" vertex="1" parent="1">
          <mxGeometry x="110" y="90" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="command_api" value="&lt;b&gt;Command API&lt;/b&gt;&lt;br/&gt;Write Operations&lt;br/&gt;POST /payments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="130" y="130" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="query_api" value="&lt;b&gt;Query API&lt;/b&gt;&lt;br/&gt;Read Operations&lt;br/&gt;GET /payments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="130" y="210" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="command_handler" value="&lt;b&gt;Command Handler&lt;/b&gt;&lt;br/&gt;Business Logic&lt;br/&gt;Validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7e57c2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="280" y="130" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="query_handler" value="&lt;b&gt;Query Handler&lt;/b&gt;&lt;br/&gt;Projections&lt;br/&gt;Aggregations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7e57c2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="280" y="210" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="event_store" value="&lt;b&gt;Event Store&lt;/b&gt;&lt;br/&gt;Event Sourcing&lt;br/&gt;Immutable log" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#5e35b1;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="430" y="130" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="read_model" value="&lt;b&gt;Read Model&lt;/b&gt;&lt;br/&gt;Denormalized&lt;br/&gt;Optimized views" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#5e35b1;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="430" y="210" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="projection_service" value="&lt;b&gt;Projection Service&lt;/b&gt;&lt;br/&gt;Event replay&lt;br/&gt;View builder" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9575cd;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="560" y="170" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Saga Pattern -->
        <mxCell id="saga_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#00897b;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="80" width="680" height="250" as="geometry" />
        </mxCell>

        <mxCell id="saga_label" value="&lt;b&gt;Saga Pattern - Distributed Transaction&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#00695c;" vertex="1" parent="1">
          <mxGeometry x="830" y="90" width="350" height="20" as="geometry" />
        </mxCell>

        <mxCell id="saga_orchestrator" value="&lt;b&gt;Saga Orchestrator&lt;/b&gt;&lt;br/&gt;Transaction coordinator&lt;br/&gt;State machine" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#009688;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1080" y="170" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="step1_payment" value="&lt;b&gt;1. Reserve Payment&lt;/b&gt;&lt;br/&gt;Compensate: Refund" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#26a69a;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="130" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="step2_inventory" value="&lt;b&gt;2. Reserve Inventory&lt;/b&gt;&lt;br/&gt;Compensate: Release" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#26a69a;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="190" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="step3_shipping" value="&lt;b&gt;3. Create Shipping&lt;/b&gt;&lt;br/&gt;Compensate: Cancel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#26a69a;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="250" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="step4_confirm" value="&lt;b&gt;4. Confirm Payment&lt;/b&gt;&lt;br/&gt;Final step" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#00897b;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1300" y="190" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Circuit Breaker Pattern -->
        <mxCell id="circuit_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c2185b;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="350" width="680" height="200" as="geometry" />
        </mxCell>

        <mxCell id="circuit_label" value="&lt;b&gt;Circuit Breaker Pattern - External API Calls&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#ad1457;" vertex="1" parent="1">
          <mxGeometry x="110" y="360" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="circuit_closed" value="&lt;b&gt;CLOSED&lt;/b&gt;&lt;br/&gt;Normal operation&lt;br/&gt;Requests pass through" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="420" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="circuit_open" value="&lt;b&gt;OPEN&lt;/b&gt;&lt;br/&gt;Service down&lt;br/&gt;Fast fail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="340" y="420" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="circuit_half_open" value="&lt;b&gt;HALF-OPEN&lt;/b&gt;&lt;br/&gt;Testing recovery&lt;br/&gt;Limited requests" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="530" y="420" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="circuit_config" value="&lt;b&gt;Configuration&lt;/b&gt;&lt;br/&gt;Threshold: 50% failures&lt;br/&gt;Timeout: 30s&lt;br/&gt;Reset: 60s" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9e9e9e;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="340" y="500" width="160" height="40" as="geometry" />
        </mxCell>

        <!-- Event Sourcing Pattern -->
        <mxCell id="event_sourcing_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ff9800;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="350" width="680" height="200" as="geometry" />
        </mxCell>

        <mxCell id="event_sourcing_label" value="&lt;b&gt;Event Sourcing Pattern - Payment History&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="830" y="360" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="event1" value="&lt;b&gt;PaymentCreated&lt;/b&gt;&lt;br/&gt;timestamp: t1&lt;br/&gt;amount: 100.00" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffb74d;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="400" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event2" value="&lt;b&gt;PaymentAuthorized&lt;/b&gt;&lt;br/&gt;timestamp: t2&lt;br/&gt;status: approved" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffb74d;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="990" y="400" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event3" value="&lt;b&gt;PaymentCaptured&lt;/b&gt;&lt;br/&gt;timestamp: t3&lt;br/&gt;captured: true" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffb74d;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="1140" y="400" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event4" value="&lt;b&gt;PaymentSettled&lt;/b&gt;&lt;br/&gt;timestamp: t4&lt;br/&gt;settled: D+1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1290" y="400" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="snapshot" value="&lt;b&gt;Snapshot&lt;/b&gt;&lt;br/&gt;Current state&lt;br/&gt;Rebuilt from events" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ef6c00;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1070" y="480" width="140" height="50" as="geometry" />
        </mxCell>

        <!-- Retry & Idempotency -->
        <mxCell id="retry_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="570" width="680" height="180" as="geometry" />
        </mxCell>

        <mxCell id="retry_label" value="&lt;b&gt;Retry Pattern with Exponential Backoff&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#1565c0;" vertex="1" parent="1">
          <mxGeometry x="110" y="580" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt1" value="&lt;b&gt;Attempt 1&lt;/b&gt;&lt;br/&gt;Immediate&lt;br/&gt;0ms delay" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="130" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt2" value="&lt;b&gt;Attempt 2&lt;/b&gt;&lt;br/&gt;Wait 1s&lt;br/&gt;+jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="250" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt3" value="&lt;b&gt;Attempt 3&lt;/b&gt;&lt;br/&gt;Wait 2s&lt;br/&gt;+jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="370" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt4" value="&lt;b&gt;Attempt 4&lt;/b&gt;&lt;br/&gt;Wait 4s&lt;br/&gt;+jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="490" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_dlq" value="&lt;b&gt;DLQ&lt;/b&gt;&lt;br/&gt;Dead Letter Queue&lt;br/&gt;Failed messages" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="610" y="620" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="idempotency_key" value="&lt;b&gt;Idempotency Key&lt;/b&gt;&lt;br/&gt;UUID per request&lt;br/&gt;Cached 24h" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0d47a1;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="340" y="690" width="160" height="40" as="geometry" />
        </mxCell>

        <!-- Service Mesh Pattern -->
        <mxCell id="mesh_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="570" width="680" height="180" as="geometry" />
        </mxCell>

        <mxCell id="mesh_label" value="&lt;b&gt;Service Mesh Pattern (Istio)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#6a1b9a;" vertex="1" parent="1">
          <mxGeometry x="830" y="580" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="service_container" value="&lt;b&gt;Service Container&lt;/b&gt;&lt;br/&gt;Business logic&lt;br/&gt;Application code" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="900" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="envoy_proxy" value="&lt;b&gt;Envoy Proxy&lt;/b&gt;&lt;br/&gt;Sidecar container&lt;br/&gt;Traffic management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ab47bc;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1040" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="control_plane" value="&lt;b&gt;Control Plane&lt;/b&gt;&lt;br/&gt;Istiod&lt;br/&gt;Configuration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7b1fa2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1180" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="observability_mesh" value="&lt;b&gt;Observability&lt;/b&gt;&lt;br/&gt;Kiali, Jaeger&lt;br/&gt;Grafana" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#8e24aa;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1320" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="mesh_features" value="&lt;b&gt;Features:&lt;/b&gt; mTLS, Traffic splitting, Canary deployments, Circuit breaking, Retry, Timeout" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=0;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="850" y="700" width="600" height="30" as="geometry" />
        </mxCell>

        <!-- Flows -->
        <mxCell id="cqrs_flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="command_api" target="command_handler">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="command_handler" target="event_store">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="event_store" target="projection_service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="projection_service" target="read_model">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>