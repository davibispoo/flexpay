<mxCell id="flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="checkout" target="load_widget">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="enter_payment" target="validate_form">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="confirm_order" target="encrypt_data">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="encrypt_data" target="send_request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="send_request" target="auth_check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="auth_check" target="rate_limit">
          <mxGeometry relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="flow9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="rate_limit" target="route_request">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="route_request" target="checkout_service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="checkout_service" target="payment_service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;dashed=1;" edge="1" parent="1" source="checkout_service" target="risk_service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="risk_service" target="fraud_bureau">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="payment_service" target="akua_api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;dashed=1;" edge="1" parent="1" source="payment_service" target="event_publish">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;dashed=1;" edge="1" parent="1" source="event_publish" target="notification_service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="notification_service" target="email_provider">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="email_provider" target="end">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Timing Labels -->
        <mxCell id="timing1" value="~100ms" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="690" y="265" width="50" height="20" as="geometry" />
        </mxCell>

        <mxCell id="timing2" value="~50ms" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="820" y="415" width="50" height="20" as="geometry" />
        </mxCell>

        <mxCell id="timing3" value="~200ms" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10;fontStyle=2;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="1110" y="665" width="50" height="20" as="geometry" />
        </mxCell>

        <mxCell id="timing4" value="Total: ~500ms" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#f44336;" vertex="1" parent="1">
          <mxGeometry x="1350" y="900" width="100" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>`,

            security: `<mxfile host="app.diagrams.net" modified="2025-01-01T12:00:00.000Z" agent="FlexPay" version="24.7.17" etag="security" type="device">
  <diagram name="Security-Architecture" id="security_architecture">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="FlexPay - Security Architecture (Zero Trust)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Perimeter Security -->
        <mxCell id="perimeter_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffebee;strokeColor=#f44336;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="1400" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="perimeter_label" value="&lt;b&gt;Perimeter Security&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#c62828;" vertex="1" parent="1">
          <mxGeometry x="110" y="90" width="200" height="20" as="geometry" />
        </mxCell>

        <mxCell id="cloudflare" value="&lt;b&gt;Cloudflare&lt;/b&gt;&lt;br/&gt;DDoS Protection&lt;br/&gt;Bot Management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="130" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="waf" value="&lt;b&gt;AWS WAF&lt;/b&gt;&lt;br/&gt;OWASP Top 10&lt;br/&gt;Custom Rules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="300" y="130" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="shield" value="&lt;b&gt;AWS Shield&lt;/b&gt;&lt;br/&gt;Advanced DDoS&lt;br/&gt;24/7 Support" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="450" y="130" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="acm" value="&lt;b&gt;ACM&lt;/b&gt;&lt;br/&gt;SSL/TLS Certs&lt;br/&gt;Auto renewal" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="600" y="130" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- Identity & Access -->
        <mxCell id="identity_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="220" width="1400" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="identity_label" value="&lt;b&gt;Identity &amp; Access Management&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#1565c0;" vertex="1" parent="1">
          <mxGeometry x="110" y="230" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="cognito" value="&lt;b&gt;AWS Cognito&lt;/b&gt;&lt;br/&gt;User pools&lt;br/&gt;MFA, SSO" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="270" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="iam" value="&lt;b&gt;AWS IAM&lt;/b&gt;&lt;br/&gt;Service roles&lt;br/&gt;Least privilege" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="300" y="270" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="vault" value="&lt;b&gt;HashiCorp Vault&lt;/b&gt;&lt;br/&gt;Secrets management&lt;br/&gt;Dynamic secrets" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="450" y="270" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="okta" value="&lt;b&gt;Okta&lt;/b&gt;&lt;br/&gt;Enterprise SSO&lt;br/&gt;SAML 2.0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="600" y="270" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="rbac" value="&lt;b&gt;RBAC&lt;/b&gt;&lt;br/&gt;Role-based access&lt;br/&gt;Fine-grained perms" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="750" y="270" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Network Security -->
        <mxCell id="network_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="390" width="700" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="network_label" value="&lt;b&gt;Network Security (Zero Trust Network)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#2e7d32;" vertex="1" parent="1">
          <mxGeometry x="110" y="400" width="350" height="20" as="geometry" />
        </mxCell>

        <mxCell id="vpc" value="&lt;b&gt;VPC&lt;/b&gt;&lt;br/&gt;Private subnets&lt;br/&gt;10.0.0.0/16" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="440" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="nacl" value="&lt;b&gt;NACLs&lt;/b&gt;&lt;br/&gt;Subnet firewall&lt;br/&gt;Stateless rules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="300" y="440" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="sg" value="&lt;b&gt;Security Groups&lt;/b&gt;&lt;br/&gt;Instance firewall&lt;br/&gt;Stateful rules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="450" y="440" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="privatelink" value="&lt;b&gt;PrivateLink&lt;/b&gt;&lt;br/&gt;Private endpoints&lt;br/&gt;No internet exposure" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="600" y="440" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="mtls" value="&lt;b&gt;mTLS&lt;/b&gt;&lt;br/&gt;Service mesh&lt;br/&gt;Zero trust comms" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#388e3c;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="375" y="520" width="150" height="50" as="geometry" />
        </mxCell>

        <!-- Data Security -->
        <mxCell id="data_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="390" width="680" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="data_label" value="&lt;b&gt;Data Security &amp; Compliance&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#6a1b9a;" vertex="1" parent="1">
          <mxGeometry x="830" y="400" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="kms" value="&lt;b&gt;AWS KMS&lt;/b&gt;&lt;br/&gt;Encryption keys&lt;br/&gt;AES-256" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="440" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="encrypt_rest" value="&lt;b&gt;Encryption at Rest&lt;/b&gt;&lt;br/&gt;S3, RDS, EBS&lt;br/&gt;All data encrypted" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1000" y="440" width="130" height="60" as="geometry" />
        </mxCell>

        <mxCell id="encrypt_transit" value="&lt;b&gt;Encryption in Transit&lt;/b&gt;&lt;br/&gt;TLS 1.3&lt;br/&gt;Perfect forward secrecy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1160" y="440" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="pci_dss" value="&lt;b&gt;PCI DSS&lt;/b&gt;&lt;br/&gt;Level 1 compliance&lt;br/&gt;Tokenization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7b1fa2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1330" y="440" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="dlp" value="&lt;b&gt;DLP&lt;/b&gt;&lt;br/&gt;PII detection&lt;br/&gt;Data masking&lt;br/&gt;Redaction" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ab47bc;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1080" y="520" width="150" height="50" as="geometry" />
        </mxCell>

        <!-- Monitoring & Response -->
        <mxCell id="monitoring_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ff9800;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="610" width="1400" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="monitoring_label" value="&lt;b&gt;Security Monitoring &amp; Incident Response&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="110" y="620" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="siem" value="&lt;b&gt;SIEM&lt;/b&gt;&lt;br/&gt;Splunk&lt;br/&gt;Real-time alerts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="670" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="guardduty" value="&lt;b&gt;GuardDuty&lt;/b&gt;&lt;br/&gt;Threat detection&lt;br/&gt;ML-based" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="300" y="670" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="cloudtrail" value="&lt;b&gt;CloudTrail&lt;/b&gt;&lt;br/&gt;Audit logs&lt;br/&gt;API tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="450" y="670" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="securityhub" value="&lt;b&gt;Security Hub&lt;/b&gt;&lt;br/&gt;Compliance checks&lt;br/&gt;CIS benchmarks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="600" y="670" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="soar" value="&lt;b&gt;SOAR&lt;/b&gt;&lt;br/&gt;Automated response&lt;br/&gt;Playbooks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="750" y="670" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="soc" value="&lt;b&gt;SOC 24/7&lt;/b&gt;&lt;br/&gt;Security team&lt;br/&gt;Incident response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff6f00;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="900" y="670" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Compliance Badges -->
        <mxCell id="compliance_badges" value="&lt;b&gt;Compliance:&lt;/b&gt; PCI DSS Level 1 | ISO 27001 | SOC 2 Type II | LGPD | GDPR" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=0;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="100" y="780" width="1400" height="20" as="geometry" />
        </mxCell>

        <!-- Security Practices -->
        <mxCell id="practices" value="&lt;b&gt;Security Practices:&lt;/b&gt; DevSecOps | SAST/DAST | Penetration Testing | Security Champions | Bug Bounty Program" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace            flow: `<mxfile host="app.diagrams.net" modified="2025-01-01T12:00:00.000Z" agent="FlexPay" version="24.7.17" etag="flow" type="device">
  <diagram name="Transaction-Flow" id="transaction_flow">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="FlexPay - Transaction Flow (End-to-End)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Swimlanes -->
        <mxCell id="customer_lane" value="Customer" style="swimlane;fillColor=#e3f2fd;strokeColor=#2196f3;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="1400" height="150" as="geometry" />
        </mxCell>

        <mxCell id="frontend_lane" value="Frontend (Widget)" style="swimlane;fillColor=#fff3e0;strokeColor=#ff9800;" vertex="1" parent="1">
          <mxGeometry x="100" y="230" width="1400" height="150" as="geometry" />
        </mxCell>

        <mxCell id="gateway_lane" value="API Gateway" style="swimlane;fillColor=#e8f5e9;strokeColor=#4caf50;" vertex="1" parent="1">
          <mxGeometry x="100" y="380" width="1400" height="150" as="geometry" />
        </mxCell>

        <mxCell id="services_lane" value="Microservices" style="swimlane;fillColor=#f3e5f5;strokeColor=#7b1fa2;" vertex="1" parent="1">
          <mxGeometry x="100" y="530" width="1400" height="200" as="geometry" />
        </mxCell>

        <mxCell id="external_lane" value="External Systems" style="swimlane;fillColor=#fce4ec;strokeColor=#c2185b;" vertex="1" parent="1">
          <mxGeometry x="100" y="730" width="1400" height="150" as="geometry" />
        </mxCell>

        <!-- Customer Actions -->
        <mxCell id="start" value="Start" style="ellipse;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;" vertex="1" parent="customer_lane">
          <mxGeometry x="20" y="50" width="60" height="60" as="geometry" />
        </mxCell>

        <mxCell id="select_product" value="Select Product" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;" vertex="1" parent="customer_lane">
          <mxGeometry x="120" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="checkout" value="Go to Checkout" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;" vertex="1" parent="customer_lane">
          <mxGeometry x="250" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="enter_payment" value="Enter Payment Info" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;" vertex="1" parent="customer_lane">
          <mxGeometry x="380" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="confirm_order" value="Confirm Order" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;" vertex="1" parent="customer_lane">
          <mxGeometry x="510" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- Frontend Actions -->
        <mxCell id="load_widget" value="Load Widget" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;" vertex="1" parent="frontend_lane">
          <mxGeometry x="250" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="validate_form" value="Validate Form" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;" vertex="1" parent="frontend_lane">
          <mxGeometry x="380" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="encrypt_data" value="Encrypt PCI Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;" vertex="1" parent="frontend_lane">
          <mxGeometry x="510" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="send_request" value="Send Request" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;" vertex="1" parent="frontend_lane">
          <mxGeometry x="640" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- Gateway Actions -->
        <mxCell id="auth_check" value="JWT Auth" style="rhombus;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;" vertex="1" parent="gateway_lane">
          <mxGeometry x="640" y="45" width="100" height="70" as="geometry" />
        </mxCell>

        <mxCell id="rate_limit" value="Rate Limiting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;" vertex="1" parent="gateway_lane">
          <mxGeometry x="770" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="route_request" value="Route Request" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;" vertex="1" parent="gateway_lane">
          <mxGeometry x="900" y="55" width="100" height="50" as="geometry" />
        </mxCell>

        <!-- Microservices Actions -->
        <mxCell id="checkout_service" value="Checkout Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;" vertex="1" parent="services_lane">
          <mxGeometry x="900" y="30" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="risk_service" value="Risk Analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;" vertex="1" parent="services_lane">
          <mxGeometry x="770" y="120" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="payment_service" value="Payment Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;" vertex="1" parent="services_lane">
          <mxGeometry x="1050" y="30" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="notification_service" value="Notification Service" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;" vertex="1" parent="services_lane">
          <mxGeometry x="1200" y="120" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event_publish" value="Publish Events" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7b1fa2;fontColor=#ffffff;" vertex="1" parent="services_lane">
          <mxGeometry x="1050" y="120" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- External Systems -->
        <mxCell id="akua_api" value="Akua.la API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;" vertex="1" parent="external_lane">
          <mxGeometry x="1050" y="55" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="fraud_bureau" value="Fraud Bureau" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;" vertex="1" parent="external_lane">
          <mxGeometry x="770" y="55" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="email_provider" value="SendGrid" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;" vertex="1" parent="external_lane">
          <mxGeometry x="1200" y="55" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="end" value="End" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;" vertex="1" parent="external_lane">
          <mxGeometry x="1350" y="50" width="60" height="60" as="geometry" />
        </mxCell>

        <!-- Flow Arrows -->
        <mxCell id="flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="start" target="select_product">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="select_product" target="checkout">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="flow3" style="edgeStyle=orthogonalE            patterns: `<mxfile host="app.diagrams.net" modified="2025-01-01T12:00:00.000Z" agent="FlexPay" version="24.7.17" etag="patterns" type="device">
  <diagram name="Design-Patterns" id="design_patterns">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="FlexPay - Design Patterns Implementation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- CQRS Pattern -->
        <mxCell id="cqrs_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#5e35b1;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="680" height="250" as="geometry" />
        </mxCell>
        
        <mxCell id="cqrs_label" value="&lt;b&gt;CQRS Pattern - Payment Service&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#4527a0;" vertex="1" parent="1">
          <mxGeometry x="110" y="90" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="command_api" value="&lt;b&gt;Command API&lt;/b&gt;&lt;br/&gt;Write Operations&lt;br/&gt;POST /payments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="130" y="130" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="query_api" value="&lt;b&gt;Query API&lt;/b&gt;&lt;br/&gt;Read Operations&lt;br/&gt;GET /payments" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="130" y="210" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="command_handler" value="&lt;b&gt;Command Handler&lt;/b&gt;&lt;br/&gt;Business Logic&lt;br/&gt;Validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7e57c2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="280" y="130" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="query_handler" value="&lt;b&gt;Query Handler&lt;/b&gt;&lt;br/&gt;Projections&lt;br/&gt;Aggregations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7e57c2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="280" y="210" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="event_store" value="&lt;b&gt;Event Store&lt;/b&gt;&lt;br/&gt;Event Sourcing&lt;br/&gt;Immutable log" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#5e35b1;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="430" y="130" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="read_model" value="&lt;b&gt;Read Model&lt;/b&gt;&lt;br/&gt;Denormalized&lt;br/&gt;Optimized views" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=10;fillColor=#5e35b1;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="430" y="210" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="projection_service" value="&lt;b&gt;Projection Service&lt;/b&gt;&lt;br/&gt;Event replay&lt;br/&gt;View builder" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9575cd;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="560" y="170" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Saga Pattern -->
        <mxCell id="saga_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#00897b;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="80" width="680" height="250" as="geometry" />
        </mxCell>
        
        <mxCell id="saga_label" value="&lt;b&gt;Saga Pattern - Distributed Transaction&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#00695c;" vertex="1" parent="1">
          <mxGeometry x="830" y="90" width="350" height="20" as="geometry" />
        </mxCell>

        <mxCell id="saga_orchestrator" value="&lt;b&gt;Saga Orchestrator&lt;/b&gt;&lt;br/&gt;Transaction coordinator&lt;br/&gt;State machine" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#009688;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1080" y="170" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="step1_payment" value="&lt;b&gt;1. Reserve Payment&lt;/b&gt;&lt;br/&gt;Compensate: Refund" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#26a69a;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="130" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="step2_inventory" value="&lt;b&gt;2. Reserve Inventory&lt;/b&gt;&lt;br/&gt;Compensate: Release" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#26a69a;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="190" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="step3_shipping" value="&lt;b&gt;3. Create Shipping&lt;/b&gt;&lt;br/&gt;Compensate: Cancel" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#26a69a;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="250" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="step4_confirm" value="&lt;b&gt;4. Confirm Payment&lt;/b&gt;&lt;br/&gt;Final step" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#00897b;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1300" y="190" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Circuit Breaker Pattern -->
        <mxCell id="circuit_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c2185b;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="350" width="680" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="circuit_label" value="&lt;b&gt;Circuit Breaker Pattern - External API Calls&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#ad1457;" vertex="1" parent="1">
          <mxGeometry x="110" y="360" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="circuit_closed" value="&lt;b&gt;CLOSED&lt;/b&gt;&lt;br/&gt;Normal operation&lt;br/&gt;Requests pass through" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="420" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="circuit_open" value="&lt;b&gt;OPEN&lt;/b&gt;&lt;br/&gt;Service down&lt;br/&gt;Fast fail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f44336;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="340" y="420" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="circuit_half_open" value="&lt;b&gt;HALF-OPEN&lt;/b&gt;&lt;br/&gt;Testing recovery&lt;br/&gt;Limited requests" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="530" y="420" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="circuit_config" value="&lt;b&gt;Configuration&lt;/b&gt;&lt;br/&gt;Threshold: 50% failures&lt;br/&gt;Timeout: 30s&lt;br/&gt;Reset: 60s" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9e9e9e;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="340" y="500" width="160" height="40" as="geometry" />
        </mxCell>

        <!-- Event Sourcing Pattern -->
        <mxCell id="event_sourcing_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ff9800;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="350" width="680" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="event_sourcing_label" value="&lt;b&gt;Event Sourcing Pattern - Payment History&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="830" y="360" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="event1" value="&lt;b&gt;PaymentCreated&lt;/b&gt;&lt;br/&gt;timestamp: t1&lt;br/&gt;amount: 100.00" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffb74d;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="400" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event2" value="&lt;b&gt;PaymentAuthorized&lt;/b&gt;&lt;br/&gt;timestamp: t2&lt;br/&gt;status: approved" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffb74d;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="990" y="400" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event3" value="&lt;b&gt;PaymentCaptured&lt;/b&gt;&lt;br/&gt;timestamp: t3&lt;br/&gt;captured: true" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffb74d;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="1140" y="400" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="event4" value="&lt;b&gt;PaymentSettled&lt;/b&gt;&lt;br/&gt;timestamp: t4&lt;br/&gt;settled: D+1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1290" y="400" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="snapshot" value="&lt;b&gt;Snapshot&lt;/b&gt;&lt;br/&gt;Current state&lt;br/&gt;Rebuilt from events" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ef6c00;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1070" y="480" width="140" height="50" as="geometry" />
        </mxCell>

        <!-- Retry & Idempotency -->
        <mxCell id="retry_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="570" width="680" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="retry_label" value="&lt;b&gt;Retry Pattern with Exponential Backoff&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#1565c0;" vertex="1" parent="1">
          <mxGeometry x="110" y="580" width="400" height="20" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt1" value="&lt;b&gt;Attempt 1&lt;/b&gt;&lt;br/&gt;Immediate&lt;br/&gt;0ms delay" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="130" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt2" value="&lt;b&gt;Attempt 2&lt;/b&gt;&lt;br/&gt;Wait 1s&lt;br/&gt;+jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="250" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt3" value="&lt;b&gt;Attempt 3&lt;/b&gt;&lt;br/&gt;Wait 2s&lt;br/&gt;+jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="370" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_attempt4" value="&lt;b&gt;Attempt 4&lt;/b&gt;&lt;br/&gt;Wait 4s&lt;br/&gt;+jitter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#42a5f5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="490" y="620" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="retry_dlq" value="&lt;b&gt;DLQ&lt;/b&gt;&lt;br/&gt;Dead Letter Queue&lt;br/&gt;Failed messages" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1976d2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="610" y="620" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="idempotency_key" value="&lt;b&gt;Idempotency Key&lt;/b&gt;&lt;br/&gt;UUID per request&lt;br/&gt;Cached 24h" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0d47a1;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="340" y="690" width="160" height="40" as="geometry" />
        </mxCell>

        <!-- Service Mesh Pattern -->
        <mxCell id="mesh_group" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="820" y="570" width="680" height="180" as="geometry" />
        </mxCell>
        
        <mxCell id="mesh_label" value="&lt;b&gt;Service Mesh Pattern (Istio)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#6a1b9a;" vertex="1" parent="1">
          <mxGeometry x="830" y="580" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="service_container" value="&lt;b&gt;Service Container&lt;/b&gt;&lt;br/&gt;Business logic&lt;br/&gt;Application code" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="900" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="envoy_proxy" value="&lt;b&gt;Envoy Proxy&lt;/b&gt;&lt;br/&gt;Sidecar container&lt;br/&gt;Traffic management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ab47bc;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1040" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="control_plane" value="&lt;b&gt;Control Plane&lt;/b&gt;&lt;br/&gt;Istiod&lt;br/&gt;Configuration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7b1fa2;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1180" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="observability_mesh" value="&lt;b&gt;Observability&lt;/b&gt;&lt;br/&gt;Kiali, Jaeger&lt;br/&gt;Grafana" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#8e24aa;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1320" y="620" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="mesh_features" value="&lt;b&gt;Features:&lt;/b&gt; mTLS, Traffic splitting, Canary deployments, Circuit breaking, Retry, Timeout" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;fontStyle=0;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="850" y="700" width="600" height="30" as="geometry" />
        </mxCell>

        <!-- Flows -->
        <mxCell id="cqrs_flow1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="command_api" target="command_handler">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_flow2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="command_handler" target="event_store">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_flow3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="event_store" target="projection_service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="cqrs_flow4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#5e35b1;strokeWidth=2;endArrow=block;endFill=1;" edge="1" parent="1" source="projection_service" target="read_model">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>`,<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexPay System Architecture - Draw.io</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            color: #333;
            font-size: 28px;
        }
        
        .header p {
            margin: 5px 0 0 0;
            color: #666;
        }
        
        .controls {
            background: white;
            padding: 15px 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn.secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn.secondary:hover {
            background: #e0e0e0;
        }
        
        select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        
        .diagram-container {
            flex: 1;
            background: white;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }
        
        #diagram {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }
        
        .info-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏗️ FlexPay System Architecture</h1>
        <p>Arquitetura detalhada com Design Patterns, Fluxo de Dados e Componentes</p>
    </div>
    
    <div class="controls">
        <select id="diagramSelector">
            <option value="system">System Design Geral</option>
            <option value="data">Arquitetura de Dados</option>
            <option value="patterns">Design Patterns</option>
            <option value="flow">Fluxo de Transação</option>
            <option value="security">Arquitetura de Segurança</option>
        </select>
        
        <button class="btn" onclick="exportDiagram()">
            📥 Exportar para Draw.io
        </button>
        
        <button class="btn secondary" onclick="downloadSVG()">
            📊 Download SVG
        </button>
        
        <button class="btn secondary" onclick="resetZoom()">
            🔄 Reset Zoom
        </button>
    </div>
    
    <div class="diagram-container">
        <div class="info-badge" id="infoBadge">System Design Geral</div>
        <div id="diagram"></div>
    </div>

    <script>
        // Diagramas em formato draw.io XML
        const diagrams = {
            system: `<mxfile host="app.diagrams.net" modified="2025-01-01T12:00:00.000Z" agent="FlexPay" version="24.7.17" etag="system" type="device">
  <diagram name="System-Design" id="system_design_general">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="FlexPay Commerce - System Design Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Load Balancer Layer -->
        <mxCell id="lb_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="1400" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="lb_label" value="&lt;b&gt;Edge Layer&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#2e7d32;" vertex="1" parent="1">
          <mxGeometry x="110" y="90" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="cloudfront" value="&lt;b&gt;CloudFront CDN&lt;/b&gt;&lt;br/&gt;Cache global, DDoS protection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="120" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="waf" value="&lt;b&gt;AWS WAF&lt;/b&gt;&lt;br/&gt;Firewall, Rate limiting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="320" y="120" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="alb" value="&lt;b&gt;Application Load Balancer&lt;/b&gt;&lt;br/&gt;SSL termination, routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="490" y="120" width="180" height="40" as="geometry" />
        </mxCell>

        <mxCell id="route53" value="&lt;b&gt;Route 53&lt;/b&gt;&lt;br/&gt;DNS, Geolocation routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="690" y="120" width="150" height="40" as="geometry" />
        </mxCell>

        <!-- API Gateway Pattern -->
        <mxCell id="gateway_pattern" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ff9800;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="200" width="1400" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="gateway_label" value="&lt;b&gt;API Gateway Pattern (Kong)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="110" y="210" width="250" height="20" as="geometry" />
        </mxCell>

        <mxCell id="auth_plugin" value="&lt;b&gt;Auth Plugin&lt;/b&gt;&lt;br/&gt;JWT, OAuth 2.0&lt;br/&gt;API Keys" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="rate_limiter" value="&lt;b&gt;Rate Limiter&lt;/b&gt;&lt;br/&gt;Token Bucket&lt;br/&gt;10k req/min" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="290" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="circuit_breaker" value="&lt;b&gt;Circuit Breaker&lt;/b&gt;&lt;br/&gt;Hystrix Pattern&lt;br/&gt;Fallback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="430" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="load_balancer_internal" value="&lt;b&gt;Load Balancer&lt;/b&gt;&lt;br/&gt;Round Robin&lt;br/&gt;Health checks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff5722;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="570" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="cache_layer" value="&lt;b&gt;Cache Layer&lt;/b&gt;&lt;br/&gt;Redis&lt;br/&gt;Response cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#795548;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="710" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service_discovery" value="&lt;b&gt;Service Discovery&lt;/b&gt;&lt;br/&gt;Consul&lt;br/&gt;Health monitoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#607d8b;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="log_aggregator" value="&lt;b&gt;Log Aggregator&lt;/b&gt;&lt;br/&gt;ELK Stack&lt;br/&gt;Distributed tracing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3f51b5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="990" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- Microservices Layer -->
        <mxCell id="microservices_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="340" width="1400" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="microservices_label" value="&lt;b&gt;Microservices Layer - Domain Driven Design&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#1565c0;" vertex="1" parent="1">
          <mxGeometry x="110" y="350" width="350" height="20" as="geometry" />
        </mxCell>

        <!-- Payment Domain -->
        <mxCell id="payment_domain" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#5e35b1;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="150" y="380" width="320" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="payment_domain_label" value="&lt;b&gt;Payment Domain&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#5e35b1;" vertex="1" parent="1">
          <mxGeometry x="150" y="385" width="320" height="20" as="geometry" />
        </mxCell>

        <mxCell id="payment_service_detail" value="&lt;b&gt;Payment Service&lt;/b&gt;&lt;br/&gt;CQRS Pattern&lt;br/&gt;Event Sourcing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="170" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="payment_saga" value="&lt;b&gt;Payment Saga&lt;/b&gt;&lt;br/&gt;Saga Pattern&lt;br/&gt;Compensation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="320" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="payment_repo" value="&lt;b&gt;Repository&lt;/b&gt;&lt;br/&gt;PostgreSQL" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#5e35b1;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="245" y="470" width="80" height="40" as="geometry" />
        </mxCell>

        <!-- Merchant Domain -->
        <mxCell id="merchant_domain" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#00897b;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="490" y="380" width="320" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="merchant_domain_label" value="&lt;b&gt;Merchant Domain&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#00897b;" vertex="1" parent="1">
          <mxGeometry x="490" y="385" width="320" height="20" as="geometry" />
        </mxCell>

        <mxCell id="merchant_service_detail" value="&lt;b&gt;Merchant Service&lt;/b&gt;&lt;br/&gt;Hexagonal Arch&lt;br/&gt;Ports & Adapters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#009688;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="510" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="kyc_service" value="&lt;b&gt;KYC Service&lt;/b&gt;&lt;br/&gt;State Machine&lt;br/&gt;Workflow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#009688;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="660" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Risk Domain -->
        <mxCell id="risk_domain" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c2185b;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="830" y="380" width="320" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="risk_domain_label" value="&lt;b&gt;Risk & Fraud Domain&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#c2185b;" vertex="1" parent="1">
          <mxGeometry x="830" y="385" width="320" height="20" as="geometry" />
        </mxCell>

        <mxCell id="risk_engine" value="&lt;b&gt;Risk Engine&lt;/b&gt;&lt;br/&gt;Rules Engine&lt;br/&gt;ML Models" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="fraud_detector" value="&lt;b&gt;Fraud Detector&lt;/b&gt;&lt;br/&gt;Anomaly Detection&lt;br/&gt;Real-time scoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1000" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Event Bus -->
        <mxCell id="event_bus_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#ffc107;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="560" width="1400" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="event_bus_label" value="&lt;b&gt;Event-Driven Architecture - Apache Kafka&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#f57c00;" vertex="1" parent="1">
          <mxGeometry x="110" y="570" width="350" height="20" as="geometry" />
        </mxCell>

        <mxCell id="payment_events" value="&lt;b&gt;payment-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;10 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="merchant_events" value="&lt;b&gt;merchant-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;5 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="320" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="risk_events" value="&lt;b&gt;risk-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;8 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="490" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="notification_events" value="&lt;b&gt;notification-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;3 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="660" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="audit_events" value="&lt;b&gt;audit-events&lt;/b&gt;&lt;br/&gt;Compacted Topic&lt;br/&gt;Infinite retention" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="830" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <!-- Data Layer -->
        <mxCell id="data_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="680" width="1400" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="data_layer_label" value="&lt;b&gt;Data Layer - Polyglot Persistence&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#6a1b9a;" vertex="1" parent="1">
          <mxGeometry x="110" y="690" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="postgres_cluster" value="&lt;b&gt;PostgreSQL&lt;/b&gt;&lt;br/&gt;Master-Slave&lt;br/&gt;Read replicas&lt;br/&gt;ACID" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#336791;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="150" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="redis_cluster" value="&lt;b&gt;Redis Cluster&lt;/b&gt;&lt;br/&gt;6 nodes&lt;br/&gt;Cache + Session&lt;br/&gt;Pub/Sub" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dc382d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="300" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="elasticsearch_cluster" value="&lt;b&gt;Elasticsearch&lt;/b&gt;&lt;br/&gt;3 nodes&lt;br/&gt;Search + Analytics&lt;br/&gt;Logs" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fed138;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="450" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="s3_storage" value="&lt;b&gt;S3 + Glacier&lt;/b&gt;&lt;br/&gt;Object Storage&lt;br/&gt;Backups&lt;br/&gt;Documents" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ff9800;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="dynamodb" value="&lt;b&gt;DynamoDB&lt;/b&gt;&lt;br/&gt;NoSQL&lt;br/&gt;Session data&lt;br/&gt;Fast lookups" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ff5722;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="750" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="timeseries_db" value="&lt;b&gt;TimescaleDB&lt;/b&gt;&lt;br/&gt;Time-series&lt;br/&gt;Metrics&lt;br/&gt;Analytics" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#00bcd4;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Observability -->
        <mxCell id="observability_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="850" width="1400" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="observability_label" value="&lt;b&gt;Observability & Monitoring&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#2e7d32;" vertex="1" parent="1">
          <mxGeometry x="110" y="860" width="250" height="20" as="geometry" />
        </mxCell>

        <mxCell id="prometheus" value="&lt;b&gt;Prometheus&lt;/b&gt;&lt;br/&gt;Metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="grafana" value="&lt;b&gt;Grafana&lt;/b&gt;&lt;br/&gt;Dashboards" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="290" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="jaeger" value="&lt;b&gt;Jaeger&lt;/b&gt;&lt;br/&gt;Distributed Tracing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="430" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="elk_stack" value="&lt;b&gt;ELK Stack&lt;/b&gt;&lt;br/&gt;Log Aggregation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="570" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="alertmanager" value="&lt;b&gt;AlertManager&lt;/b&gt;&lt;br/&gt;Alerting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="710" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <!-- Security Patterns -->
        <mxCell id="security_patterns" value="&lt;b&gt;Security Patterns:&lt;/b&gt; Zero Trust, mTLS, Vault Secrets, SIEM" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=0;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="100" y="970" width="1400" height="20" as="geometry" />
        </mxCell>

        <!-- Design Patterns Legend -->
        <mxCell id="patterns_legend" value="&lt;b&gt;Design Patterns Applied:&lt;/b&gt; CQRS, Event Sourcing, Saga, Circuit Breaker, API Gateway, Service Mesh, Sidecar, Ambassador, BFF" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=0;fontColor=#666;" vertex="1" parent="1">
          <mxGeometry x="100" y="1000" width="1400" height="20" as="geometry" />
        </mxCell>

        <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexPay System Architecture - Draw.io</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            margin: 0;
            color: #333;
            font-size: 28px;
        }
        
        .header p {
            margin: 5px 0 0 0;
            color: #666;
        }
        
        .controls {
            background: white;
            padding: 15px 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .btn.secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn.secondary:hover {
            background: #e0e0e0;
        }
        
        select {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        
        .diagram-container {
            flex: 1;
            background: white;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            position: relative;
        }
        
        #diagram {
            width: 100%;
            height: 100%;
            min-height: 600px;
        }
        
        .info-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(102, 126, 234, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏗️ FlexPay System Architecture</h1>
        <p>Arquitetura detalhada com Design Patterns, Fluxo de Dados e Componentes</p>
    </div>
    
    <div class="controls">
        <select id="diagramSelector">
            <option value="system">System Design Geral</option>
            <option value="data">Arquitetura de Dados</option>
            <option value="patterns">Design Patterns</option>
            <option value="flow">Fluxo de Transação</option>
            <option value="security">Arquitetura de Segurança</option>
        </select>
        
        <button class="btn" onclick="exportDiagram()">
            📥 Exportar para Draw.io
        </button>
        
        <button class="btn secondary" onclick="downloadSVG()">
            📊 Download SVG
        </button>
        
        <button class="btn secondary" onclick="resetZoom()">
            🔄 Reset Zoom
        </button>
    </div>
    
    <div class="diagram-container">
        <div class="info-badge" id="infoBadge">System Design Geral</div>
        <div id="diagram"></div>
    </div>

    <script>
        // Diagramas em formato draw.io XML
        const diagrams = {
            system: `<mxfile host="app.diagrams.net" modified="2025-01-01T12:00:00.000Z" agent="FlexPay" version="24.7.17" etag="system" type="device">
  <diagram name="System-Design" id="system_design_general">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Title -->
        <mxCell id="title" value="FlexPay Commerce - System Design Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=22;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="600" height="40" as="geometry" />
        </mxCell>

        <!-- Load Balancer Layer -->
        <mxCell id="lb_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="80" width="1400" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="lb_label" value="&lt;b&gt;Edge Layer&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#2e7d32;" vertex="1" parent="1">
          <mxGeometry x="110" y="90" width="150" height="20" as="geometry" />
        </mxCell>

        <mxCell id="cloudfront" value="&lt;b&gt;CloudFront CDN&lt;/b&gt;&lt;br/&gt;Cache global, DDoS protection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="120" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="waf" value="&lt;b&gt;AWS WAF&lt;/b&gt;&lt;br/&gt;Firewall, Rate limiting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="320" y="120" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="alb" value="&lt;b&gt;Application Load Balancer&lt;/b&gt;&lt;br/&gt;SSL termination, routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="490" y="120" width="180" height="40" as="geometry" />
        </mxCell>

        <mxCell id="route53" value="&lt;b&gt;Route 53&lt;/b&gt;&lt;br/&gt;DNS, Geolocation routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="690" y="120" width="150" height="40" as="geometry" />
        </mxCell>

        <!-- API Gateway Pattern -->
        <mxCell id="gateway_pattern" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff3e0;strokeColor=#ff9800;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="200" width="1400" height="120" as="geometry" />
        </mxCell>
        
        <mxCell id="gateway_label" value="&lt;b&gt;API Gateway Pattern (Kong)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#e65100;" vertex="1" parent="1">
          <mxGeometry x="110" y="210" width="250" height="20" as="geometry" />
        </mxCell>

        <mxCell id="auth_plugin" value="&lt;b&gt;Auth Plugin&lt;/b&gt;&lt;br/&gt;JWT, OAuth 2.0&lt;br/&gt;API Keys" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="rate_limiter" value="&lt;b&gt;Rate Limiter&lt;/b&gt;&lt;br/&gt;Token Bucket&lt;br/&gt;10k req/min" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2196f3;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="290" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="circuit_breaker" value="&lt;b&gt;Circuit Breaker&lt;/b&gt;&lt;br/&gt;Hystrix Pattern&lt;br/&gt;Fallback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9c27b0;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="430" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="load_balancer_internal" value="&lt;b&gt;Load Balancer&lt;/b&gt;&lt;br/&gt;Round Robin&lt;br/&gt;Health checks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff5722;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="570" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="cache_layer" value="&lt;b&gt;Cache Layer&lt;/b&gt;&lt;br/&gt;Redis&lt;br/&gt;Response cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#795548;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="710" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="service_discovery" value="&lt;b&gt;Service Discovery&lt;/b&gt;&lt;br/&gt;Consul&lt;br/&gt;Health monitoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#607d8b;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="log_aggregator" value="&lt;b&gt;Log Aggregator&lt;/b&gt;&lt;br/&gt;ELK Stack&lt;br/&gt;Distributed tracing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3f51b5;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="990" y="250" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- Microservices Layer -->
        <mxCell id="microservices_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e3f2fd;strokeColor=#2196f3;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="340" width="1400" height="200" as="geometry" />
        </mxCell>
        
        <mxCell id="microservices_label" value="&lt;b&gt;Microservices Layer - Domain Driven Design&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#1565c0;" vertex="1" parent="1">
          <mxGeometry x="110" y="350" width="350" height="20" as="geometry" />
        </mxCell>

        <!-- Payment Domain -->
        <mxCell id="payment_domain" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8eaf6;strokeColor=#5e35b1;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="150" y="380" width="320" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="payment_domain_label" value="&lt;b&gt;Payment Domain&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#5e35b1;" vertex="1" parent="1">
          <mxGeometry x="150" y="385" width="320" height="20" as="geometry" />
        </mxCell>

        <mxCell id="payment_service_detail" value="&lt;b&gt;Payment Service&lt;/b&gt;&lt;br/&gt;CQRS Pattern&lt;br/&gt;Event Sourcing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="170" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="payment_saga" value="&lt;b&gt;Payment Saga&lt;/b&gt;&lt;br/&gt;Saga Pattern&lt;br/&gt;Compensation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#673ab7;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="320" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="payment_repo" value="&lt;b&gt;Repository&lt;/b&gt;&lt;br/&gt;PostgreSQL" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=8;fillColor=#5e35b1;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="245" y="470" width="80" height="40" as="geometry" />
        </mxCell>

        <!-- Merchant Domain -->
        <mxCell id="merchant_domain" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0f2f1;strokeColor=#00897b;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="490" y="380" width="320" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="merchant_domain_label" value="&lt;b&gt;Merchant Domain&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#00897b;" vertex="1" parent="1">
          <mxGeometry x="490" y="385" width="320" height="20" as="geometry" />
        </mxCell>

        <mxCell id="merchant_service_detail" value="&lt;b&gt;Merchant Service&lt;/b&gt;&lt;br/&gt;Hexagonal Arch&lt;br/&gt;Ports & Adapters" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#009688;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="510" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="kyc_service" value="&lt;b&gt;KYC Service&lt;/b&gt;&lt;br/&gt;State Machine&lt;br/&gt;Workflow" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#009688;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="660" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Risk Domain -->
        <mxCell id="risk_domain" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fce4ec;strokeColor=#c2185b;strokeWidth=1;" vertex="1" parent="1">
          <mxGeometry x="830" y="380" width="320" height="140" as="geometry" />
        </mxCell>
        
        <mxCell id="risk_domain_label" value="&lt;b&gt;Risk & Fraud Domain&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#c2185b;" vertex="1" parent="1">
          <mxGeometry x="830" y="385" width="320" height="20" as="geometry" />
        </mxCell>

        <mxCell id="risk_engine" value="&lt;b&gt;Risk Engine&lt;/b&gt;&lt;br/&gt;Rules Engine&lt;br/&gt;ML Models" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="850" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="fraud_detector" value="&lt;b&gt;Fraud Detector&lt;/b&gt;&lt;br/&gt;Anomaly Detection&lt;br/&gt;Real-time scoring" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e91e63;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="1000" y="410" width="130" height="50" as="geometry" />
        </mxCell>

        <!-- Event Bus -->
        <mxCell id="event_bus_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff8e1;strokeColor=#ffc107;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="560" width="1400" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="event_bus_label" value="&lt;b&gt;Event-Driven Architecture - Apache Kafka&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#f57c00;" vertex="1" parent="1">
          <mxGeometry x="110" y="570" width="350" height="20" as="geometry" />
        </mxCell>

        <mxCell id="payment_events" value="&lt;b&gt;payment-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;10 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="merchant_events" value="&lt;b&gt;merchant-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;5 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="320" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="risk_events" value="&lt;b&gt;risk-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;8 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="490" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="notification_events" value="&lt;b&gt;notification-events&lt;/b&gt;&lt;br/&gt;Topic&lt;br/&gt;3 partitions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffc107;fontColor=#000000;align=center;" vertex="1" parent="1">
          <mxGeometry x="660" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <mxCell id="audit_events" value="&lt;b&gt;audit-events&lt;/b&gt;&lt;br/&gt;Compacted Topic&lt;br/&gt;Infinite retention" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ff9800;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="830" y="600" width="150" height="40" as="geometry" />
        </mxCell>

        <!-- Data Layer -->
        <mxCell id="data_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f3e5f5;strokeColor=#7b1fa2;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="680" width="1400" height="150" as="geometry" />
        </mxCell>
        
        <mxCell id="data_layer_label" value="&lt;b&gt;Data Layer - Polyglot Persistence&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#6a1b9a;" vertex="1" parent="1">
          <mxGeometry x="110" y="690" width="300" height="20" as="geometry" />
        </mxCell>

        <mxCell id="postgres_cluster" value="&lt;b&gt;PostgreSQL&lt;/b&gt;&lt;br/&gt;Master-Slave&lt;br/&gt;Read replicas&lt;br/&gt;ACID" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#336791;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="150" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="redis_cluster" value="&lt;b&gt;Redis Cluster&lt;/b&gt;&lt;br/&gt;6 nodes&lt;br/&gt;Cache + Session&lt;br/&gt;Pub/Sub" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#dc382d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="300" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="elasticsearch_cluster" value="&lt;b&gt;Elasticsearch&lt;/b&gt;&lt;br/&gt;3 nodes&lt;br/&gt;Search + Analytics&lt;br/&gt;Logs" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#fed138;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="450" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="s3_storage" value="&lt;b&gt;S3 + Glacier&lt;/b&gt;&lt;br/&gt;Object Storage&lt;br/&gt;Backups&lt;br/&gt;Documents" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ff9800;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="dynamodb" value="&lt;b&gt;DynamoDB&lt;/b&gt;&lt;br/&gt;NoSQL&lt;br/&gt;Session data&lt;br/&gt;Fast lookups" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#ff5722;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="750" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="timeseries_db" value="&lt;b&gt;TimescaleDB&lt;/b&gt;&lt;br/&gt;Time-series&lt;br/&gt;Metrics&lt;br/&gt;Analytics" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#00bcd4;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="730" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Observability -->
        <mxCell id="observability_layer" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;strokeWidth=2;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="850" width="1400" height="100" as="geometry" />
        </mxCell>
        
        <mxCell id="observability_label" value="&lt;b&gt;Observability & Monitoring&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;fontColor=#2e7d32;" vertex="1" parent="1">
          <mxGeometry x="110" y="860" width="250" height="20" as="geometry" />
        </mxCell>

        <mxCell id="prometheus" value="&lt;b&gt;Prometheus&lt;/b&gt;&lt;br/&gt;Metrics" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="150" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="grafana" value="&lt;b&gt;Grafana&lt;/b&gt;&lt;br/&gt;Dashboards" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="290" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="jaeger" value="&lt;b&gt;Jaeger&lt;/b&gt;&lt;br/&gt;Distributed Tracing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4caf50;fontColor=#ffffff;align=center;" vertex="1" parent="1">
          <mxGeometry x="430" y="890" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="elk_stack" value="&lt;b&gt;ELK Stack&lt;/b&gt;&lt;br/